# Session Context - Homelab Notebook

**Last Updated:** 2025-11-30
**Session Purpose:** Complete UI/UX migration to three-mode architecture

---

## Workflow Progress

| Phase | Status | Notes |
|-------|--------|-------|
| Project Brief v2 | COMPLETE | .docs/homelab-notebook-brief-v1.md |
| UI/UX Redesign | COMPLETE | .docs/ui-ux-redesign-v2.md |
| Migration Phase 1 | COMPLETE | Core structure, routes, AppShell, sidebar |
| Migration Phase 2 | COMPLETE | Entry features, forms, timeline, editor, tags |
| Migration Phase 3 | COMPLETE | Projects & organization |
| Migration Phase 4 | COMPLETE | Search & navigation (FlexSearch, ⌘K) |
| Migration Phase 5 | COMPLETE | Mode promotion, cross-refs, dashboard |
| Migration Phase 6 | COMPLETE | Polish, loading states, AI stubs |

**Mode:** DELIVERY (practical utility focus)

---

## Current State

### What's Built (This Session - Complete Rebuild)

#### Three-Mode Architecture
- **Research Mode** (`/research`) - Resource collection, URLs, links
- **Project Mode** (`/project`) - Developer journal with timeline view
- **Reference Mode** (`/reference`) - Polished documentation/tutorials

#### Core Features
- Mode promotion workflow (move/copy entries between modes)
- Cross-entry linking system
- FlexSearch-powered instant search (⌘K)
- Quick capture modal (⌘N)
- Project timeline with date groupings
- Toast notifications
- View preferences (persisted to localStorage)

#### Routes Created
- `/` - Dashboard with mode overview, recent entries, active projects
- `/research`, `/research/new`, `/research/[id]`, `/research/[id]/edit`
- `/project`, `/project/new`, `/project/[id]`, `/project/[id]/edit`
- `/reference`, `/reference/new`, `/reference/[id]`, `/reference/[id]/edit`
- `/projects`, `/projects/[id]` - Project management
- `/tags` - Tag management
- `/recent` - Recent entries across all modes
- `/archived` - Archived entries
- `/settings` - View preferences and keyboard shortcuts

#### Components Created
- **Layout:** AppShell, Sidebar, Header, Toast
- **UI:** Button, Input, Badge, Modal, Skeleton, EmptyState, ErrorBanner
- **Editor:** MarkdownEditor, TagInput
- **Features:** QuickCaptureModal, NewProjectModal, PromoteEntryModal, LinkEntriesModal
- **Nav:** GlobalSearch

#### Stores
- `entries` - Entry CRUD with mode filtering
- `projects` - Project management
- `tags` - Tag management
- `ui` - UI state, toasts, view preferences
- `search` - FlexSearch integration

#### Services
- `pocketbase.ts` - PocketBase client and CRUD operations
- `ai.ts` - Ollama integration stubs (for future AI features)

### Bug Fixes Applied
- Fixed Svelte 5 `onclick|stopPropagation` syntax (invalid in Svelte 5)
- Fixed nested button in sidebar (invalid HTML)
- Added timeout for PocketBase connection (prevents infinite loading)
- Fixed TagInput to use store when availableTags not provided
- Added minHeight prop to MarkdownEditor
- Added promoted_from and linked_entries to EntryFormData type

---

## Key Architecture Decisions

### Mode Philosophy
- **Primary mode with promotion** - Entries start in one mode, can be promoted/moved
- **Projects optional** - Entries don't require a project association
- **Flexible timeline** - Both newest-first and oldest-first views available

### Data Model
```
entries: id, mode, title, content, url, project, tags[], linked_entries[], promoted_from, archived
projects: id, name, description, status, color
tags: id, name, category, color, auto_generated
```

### Mode Colors
- Research: Blue (`text-blue-600`, `bg-blue-50`)
- Project: Amber (`text-amber-600`, `bg-amber-50`)
- Reference: Green (`text-green-600`, `bg-green-50`)

---

## Known Issues

1. **Vite version conflict** - TypeScript error in vite.config.ts (pre-existing, doesn't affect runtime)
2. **PocketBase collections needed** - Need to create entries, projects, tags collections in PocketBase

---

## Next Actions

1. Set up PocketBase collections (entries, projects, tags)
2. Test full CRUD operations
3. Deploy to production (notebook.haugaard.dev)

---

## Reference Files

- `.docs/homelab-notebook-brief-v1.md` - Alternative project brief (three-mode system)
- `.docs/ui-ux-redesign-v2.md` - Comprehensive UI/UX specification
- `CLAUDE.md` - Updated project documentation
- `src/lib/types/index.ts` - TypeScript types and mode configs
- `src/lib/services/pocketbase.ts` - PocketBase integration
- `src/lib/services/ai.ts` - AI extension stubs
