# Session Context - Homelab Notebook

**Last Updated:** 2025-12-02
**Session Purpose:** Pre-Deployment Review

---

## Workflow Progress

| Phase | Status | Notes |
|-------|--------|-------|
| Project Brief v2 | COMPLETE | .docs/homelab-notebook-brief-v1.md |
| UI/UX Redesign | COMPLETE | .docs/ui-ux-redesign-v2.md |
| Migration Phase 1-6 | COMPLETE | Core structure, features, polish |
| PocketBase Setup | COMPLETE | Collections on production VPS |
| App Init Fix | COMPLETE | Fixed SSR hydration blocking issue |
| UI Refresh | COMPLETE | Notion-inspired sidebar layout with mobile support |
| Deployment Strategy | COMPLETE | .docs/deployment-strategy-updated.md |
| Production PocketBase | COMPLETE | Connected to pocketbase.haugaard.dev |
| Dependency Fix | COMPLETE | Resolved vite version conflict |
| File Attachments | COMPLETE | Components ready, PocketBase field added |
| Search Relocation | COMPLETE | Moved to Header center |
| Carta Editor | COMPLETE | Merged to main |
| Pre-Deploy Review | IN PROGRESS | Verify PocketBase, then deploy |

**Mode:** DELIVERY (practical utility focus)

---

## Current State

### Latest Session (2025-12-02) - Pre-Deployment

#### Completed
- Merged `editor` branch to `main` (Carta markdown editor)
- Pushed to GitHub
- Cleaned up local branch

#### Current Status
- App feature-complete for v0.1
- PocketBase collections configured (including attachments)
- Ready for Fly.io deployment with Tigris object storage

#### Pending (post-deploy)
- Upgrade vitest to v4 (dev tooling, tracked in `.claude/todo.md`)
- Test file attachments in production

---

### Previous Session (2025-12-01 Night) - Carta Editor

#### Carta Markdown Editor
- Replaced basic textarea/preview with Carta markdown editor
- Added `carta-md` (4.11.1) and `isomorphic-dompurify` for XSS protection
- Tabs mode (Write / Preview) with live rendering
- Themed to match app CSS variables
- Same `bind:value` API — drop-in replacement

---

### Previous Session (2025-12-01 Late Evening) - UI & Attachments

#### Features Implemented

1. **File Attachments Feature**
   - Added `attachments` field to Entry type
   - Created `AttachmentDropZone` component (drag/drop + browse)
   - Created `AttachmentList` component (view/download existing)
   - Updated entry service for FormData file uploads
   - Supports PDF, DOCX, XLSX, images with type icons

2. **Form Layout Improvements**
   - Project selector: Narrower (`max-w-xs`)
   - Tags & Attachments: Side-by-side grid layout
   - Cleaner visual hierarchy

3. **Search Relocated to Header**
   - Moved from sidebar footer to Header center
   - Keyboard shortcut hint preserved (⌘K)
   - Removed duplicate from sidebar

4. **Project Navigation Fix**
   - Fixed sidebar project links not updating main view
   - Changed `onMount` to `$effect` for reactive data loading

#### Files Created
- `src/lib/components/ui/AttachmentDropZone.svelte`
- `src/lib/components/ui/AttachmentList.svelte`

#### Files Modified
- `src/lib/types/index.ts` - Added attachments field
- `src/lib/services/pocketbase.ts` - FormData upload support
- `src/lib/components/ui/index.ts` - Export new components
- `src/lib/components/layout/Header.svelte` - Added search bar
- `src/lib/components/layout/Sidebar.svelte` - Removed search
- `src/routes/research/new/+page.svelte` - New layout
- `src/routes/project/new/+page.svelte` - New layout
- `src/routes/reference/new/+page.svelte` - New layout
- `src/routes/projects/[id]/+page.svelte` - Fixed navigation

---

## Configuration

### Local Development (Both Machines)
- **PocketBase**: Production instance at `https://pocketbase.haugaard.dev`
- **ENV**: `PUBLIC_POCKETBASE_URL=https://pocketbase.haugaard.dev` in `.env.local`
- **API Rules**: All collections have empty rules (public access)
- **PocketBase Admin**: https://pocketbase.haugaard.dev/_/

### Production (VPS - Hostinger)
- **VPS**: 72.60.27.146 (8 cores, 32GB RAM)
- **PocketBase**: pocketbase.haugaard.dev (existing instance)
- **Frontend**: To be deployed at notebook.haugaard.dev
- **Reverse Proxy**: Caddy with automatic HTTPS

---

## PocketBase Collections (Verified)

Collections configured at `pocketbase.haugaard.dev`:
- **entries** - Main content (includes `attachments` file field)
- **projects** - Project organizers
- **tags** - Tag taxonomy

---

## Next Actions

1. Final review of PocketBase collections
2. Deploy to Fly.io using `deploy-guide` skill
3. Configure Tigris object storage for attachments
4. Test app in production
5. Upgrade vitest to v4 (post-deploy)

---

## Reference Files

- `.docs/homelab-notebook-brief-v1.md` - Project brief
- `.docs/ui-ux-redesign-v2.md` - UI/UX specification
- `.docs/deployment-strategy-updated.md` - Deployment plan
- `CLAUDE.md` - Project documentation
- `src/lib/types/index.ts` - TypeScript types and mode configs
- `src/app.css` - Theme and design system
