# Deployment Log

## Latest Deployment

**Date:** 2025-12-03
**Target:** Fly.io
**Region:** sjc (San Jose)
**Branch:** main
**Commit:** 430909e
**Deployed by:** Claude Code (deploy-guide skill)
**Status:** SUCCESS

### Pre-Deployment Checks
- [x] Code committed and pushed
- [x] Build passed locally
- [x] Dockerfile ready (production target)
- [x] fly.toml created

### Deployment Steps Executed
1. Created Fly.io app: `fly apps create homelab-notebook`
2. Set secret: `fly secrets set PUBLIC_POCKETBASE_URL="http://proposaltracker-api.internal:8080"`
3. Deployed: `fly deploy`
4. Added custom domain certificate: `fly certs add homelab-notebook.haugaard.app`
5. Configured DNS (CNAME on Cloudflare, gray cloud)

### Post-Deployment Verification
- [x] Application accessible at https://homelab-notebook.fly.dev
- [x] Custom domain working at https://homelab-notebook.haugaard.app
- [x] SSL certificate issued (Let's Encrypt, auto-renews)
- [x] HTTP 200 responses

### URLs
- **Production:** https://homelab-notebook.haugaard.app
- **Fly.io default:** https://homelab-notebook.fly.dev
- **PocketBase Admin:** https://proposaltracker-api.fly.dev/_/

---

## Deployment Runbook

### Regular Deployment

```bash
# From project root
fly deploy
```

### Quick Status Check

```bash
fly status
fly logs
```

### Rollback Procedure

```bash
# List recent deployments
fly releases

# Roll back to previous version
fly deploy --image <previous-image>
```

---

## Environment Variables

| Variable | Value | Where Set |
|----------|-------|-----------|
| `PUBLIC_POCKETBASE_URL` | `http://proposaltracker-api.internal:8080` | Fly secrets |
| `NODE_ENV` | `production` | Dockerfile |
| `PORT` | `3000` | fly.toml |

### View/Modify Secrets

```bash
# List secrets
fly secrets list

# Set a secret
fly secrets set KEY="value"

# Remove a secret
fly secrets unset KEY
```

---

## Infrastructure Details

| Aspect | Value |
|--------|-------|
| **App Name** | homelab-notebook |
| **Region** | sjc (San Jose) |
| **VM** | shared-cpu-1x, 512MB RAM |
| **Backend** | proposaltracker-api.internal:8080 (PocketBase) |
| **DNS** | CNAME → l26zxd1.homelab-notebook.fly.dev |
| **SSL** | Let's Encrypt (auto-renews) |

---

## DNS Configuration

**Provider:** Cloudflare (gray cloud / DNS only)

| Type | Name | Target |
|------|------|--------|
| CNAME | homelab-notebook | l26zxd1.homelab-notebook.fly.dev |

---

## Monitoring

| What | Command |
|------|---------|
| App status | `fly status` |
| Live logs | `fly logs` |
| SSH into machine | `fly ssh console` |
| Metrics | Fly.io dashboard |

---

## Troubleshooting

### App not responding
```bash
fly status          # Check machine state
fly logs            # Check for errors
fly restart         # Restart machines
```

### PocketBase connection issues
- Verify both apps are in same Fly.io organization
- Check internal URL: `http://proposaltracker-api.internal:8080`
- Test from inside: `fly ssh console` then `curl http://proposaltracker-api.internal:8080/api/health`

### SSL certificate issues
```bash
fly certs check homelab-notebook.haugaard.app
```

### Redeploy from scratch
```bash
fly deploy --build-only   # Just build, don't deploy
fly deploy                # Build and deploy
```

---

## Deployment History

| Date | Commit | Status | Notes |
|------|--------|--------|-------|
| 2025-12-03 | 430909e | SUCCESS | Initial deployment to Fly.io |

---

## Cost Tracking

**Current tier:** Likely within free tier (3 shared VMs, 256MB each)

**Actual usage:** 2 machines × shared-cpu-1x × 512MB

Monitor at: https://fly.io/dashboard/personal/billing

---

## Next Steps (Optional)

- [ ] Enable GitHub auto-deploy in Fly.io dashboard
- [ ] Set up Tigris storage for file attachments (see deployment-strategy-updated.md)
- [ ] Configure PocketBase collections for notebook entries

---

*Generated by deploy-guide skill*
